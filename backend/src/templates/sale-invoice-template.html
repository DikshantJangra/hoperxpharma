<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Invoice - {{invoiceNumber}}</title>
    <style>
        @page {
            size: A4;
            margin: 10mm;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 10px;
            color: #000;
            line-height: 1.2;
            -webkit-print-color-adjust: exact;
        }

        .container {
            width: 100%;
        }

        /* Helpers */
        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .justify-between {
            justify-content: space-between;
        }

        .items-center {
            align-items: center;
        }

        .items-end {
            align-items: flex-end;
        }

        .font-bold {
            font-weight: bold;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .uppercase {
            text-transform: uppercase;
        }

        .w-full {
            width: 100%;
        }

        /* Borders */
        .border-t {
            border-top: 1px solid #000;
        }

        .border-b {
            border-bottom: 1px solid #000;
        }

        .border-x {
            border-left: 1px solid #000;
            border-right: 1px solid #000;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .logo-section {
            width: 100px;
            margin-right: 10px;
            margin-top: 0;
            padding: 0;
        }

        .store-details {
            flex: 1;
        }

        .store-name {
            font-size: 20px;
            font-weight: 900;
            color: #000;
            /* Changed to Black as per user request */
            margin-bottom: 2px;
        }

        .store-subtitle {
            font-size: 9px;
            margin-bottom: 2px;
        }

        .store-address {
            font-size: 10px;
            margin-bottom: 4px;
        }

        .store-contact {
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 4px;
        }

        .license-grid {
            display: flex;
            gap: 15px;
            font-size: 8px;
            margin-top: 4px;
        }

        .license-item {
            border-right: 1px solid #ccc;
            padding-right: 10px;
        }

        .license-item:last-child {
            border: none;
        }

        .invoice-meta {
            text-align: right;
            min-width: 150px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .invoice-title {
            font-size: 14px;
            font-weight: bold;
        }

        .qr-placeholder {
            width: 50px;
            height: 50px;
            background: #eee;
            margin-top: 5px;
        }

        /* Patient Bar */
        .patient-bar {
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
            padding: 4px 0;
            display: flex;
            font-weight: bold;
            font-size: 10px;
        }

        .patient-label {
            margin-right: 5px;
            font-weight: bold;
        }

        .patient-val {
            margin-right: 15px;
            font-weight: normal;
        }

        /* Table */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
        }

        .items-table th {
            border-bottom: 1px solid #000;
            padding: 4px 2px;
            text-align: left;
            font-size: 9px;
            font-weight: bold;
        }

        .items-table td {
            padding: 3px 2px;
            border-bottom: 1px dotted #999;
            font-size: 9px;
            valign: top;
        }

        /* Footer */
        .watermark {
            text-align: center;
            margin: 20px 0;
            opacity: 0.1;
        }

        .watermark img {
            width: 100px;
        }

        .footer-grid {
            display: flex;
            border-top: 2px solid #000;
            margin-top: 10px;
        }

        .terms-col {
            flex: 1;
            padding-top: 5px;
            font-size: 9px;
            padding-right: 10px;
        }

        .sign-col {
            width: 100px;
            border-right: 1px solid #000;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 5px;
        }

        .stats-col {
            width: 250px;
            display: flex;
        }

        .tax-box {
            flex: 1;
            border-right: 1px solid #000;
            padding: 5px;
            font-size: 9px;
        }

        .totals-box {
            flex: 1.5;
            padding: 5px;
            font-size: 10px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2px;
        }

        .net-payable {
            font-size: 12px;
            font-weight: bold;
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
            margin: 5px 0;
            padding: 2px 0;
        }

        .saving-row {
            font-size: 9px;
            text-align: right;
        }

        .bottom-bar {
            border-top: 2px solid #000;
            margin-top: 5px;
            padding-top: 4px;
            text-align: right;
            font-size: 9px;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-section">
                {{#if store.logoUrl}}
                <img src="{{store.logoUrl}}" style="width: 100%;" alt="Logo">
                {{/if}}
            </div>
            <div class="store-details">
                <div class="store-name">{{store.displayName}}</div>
                {{#if store.subtitle}}
                <div class="store-subtitle">{{store.subtitle}}</div>
                {{/if}}
                <div class="store-address">{{store.addressLine1}} {{store.city}}-{{store.pinCode}}</div>
                {{#if store.phone}}
                <div class="store-contact">M.{{store.phone}}</div>
                {{/if}}
                <div class="license-grid">
                    {{#each store.licenses}}
                    <div class="license-item">
                        <span style="color:#666">{{this.name}} :</span> <strong>{{this.number}}</strong>
                    </div>
                    {{/each}}
                    {{#if store.fssai}}
                    <div class="license-item"><span style="color:#666">FSSAI :</span> <strong>{{store.fssai}}</strong>
                    </div>
                    {{/if}}
                    {{#if store.gstin}}
                    <div class="license-item"><span style="color:#666">GSTIN :</span> <strong>{{store.gstin}}</strong>
                    </div>
                    {{/if}}
                    {{#if store.pan}}
                    <div class="license-item"><span style="color:#666">PAN :</span> <strong>{{store.pan}}</strong></div>
                    {{/if}}
                </div>
            </div>
            <div class="invoice-meta">
                <div class="invoice-title">Invoice</div>
                <div><b>Bill No: {{invoiceNumber}}</b></div>
                <div>Payment: Mixed/Cash</div>
                <div>{{invoiceDate}} {{invoiceTime}}</div>
                <div class="qr-placeholder">
                    {{#if qrCodeUrl}}<img src="{{qrCodeUrl}}" width="50" height="50">{{/if}}
                    {{#if qrCodeUrl}}
                    <div style="font-size:6px; text-align:center; padding-top:2px; color:#000; font-weight:bold;">Scan
                        to Pay</div>
                    {{/if}}
                </div>
            </div>
        </div>

        <!-- Patient Info -->
        <div class="patient-bar">
            <span class="patient-label">PATIENT NAME</span>
            <span class="patient-val uppercase">{{patient.name}}</span>
            {{#if patient.gender}}<span class="patient-val"><strong>{{patient.gender}}</strong></span>{{/if}}
            {{#if patient.phone}}<span class="patient-val">{{patient.phone}}</span>{{/if}}

            <span class="patient-label" style="margin-left:auto;">Ref. By.</span>
            <span class="patient-val">{{patient.refBy}}</span>
        </div>

        <!-- Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th width="5%">Sr.</th>
                    <th width="35%">Medicines</th>
                    <th width="10%">HSN</th>
                    <th width="10%">Packing</th>
                    <th width="10%">Batch</th>
                    <th width="8%">Exp</th>
                    <th width="10%" class="text-right">MRP</th>
                    <!-- Removed Prev.MRP -->
                    <th width="6%" class="text-center">QTY.</th>
                    <!-- Removed D.Price -->
                    <th width="6%" class="text-center">GST</th>
                    <th width="10%" class="text-right">Amount</th>
                </tr>
            </thead>
            <tbody>
                {{#each items}}
                <tr>
                    <td>{{srNo}}</td>
                    <td>
                        <div class="font-bold">{{drugName}}</div>
                    </td>
                    <td>{{hsnCode}}</td>
                    <td>{{packSize}}</td>
                    <td>{{batchNumber}}</td>
                    <td>{{expiryDate}}</td>
                    <td class="text-right">{{mrp}}</td>
                    <td class="text-center font-bold">{{quantity}}</td>
                    <td class="text-center">{{gstPercent}}</td>
                    <td class="text-right font-bold">{{lineTotal}}</td>
                </tr>
                {{/each}}
            </tbody>
        </table>

        <!-- Watermark/Center Logo -->
        {{#if store.logoUrl}}
        <div class="watermark">
            <img src="{{store.logoUrl}}" style="filter: grayscale(100%);">
        </div>
        {{/if}}

        <!-- Footer -->
        <div class="footer-grid">
            <div class="terms-col">
                <div class="font-bold border-b" style="margin-bottom: 4px;">Terms & Conditions</div>
                <ul style="padding-left: 12px; margin: 0; list-style-type: decimal; color: #444;">
                    {{#each store.terms}}
                    <li>{{this}}</li>
                    {{/each}}
                </ul>
            </div>

            <div class="sign-col">
                {{#if soldBySignature}}
                <img src="{{soldBySignature}}" height="80" style="margin-bottom: 2px;">
                {{else}}
                <div style="height: 80px;"></div>
                {{/if}}
                <div class="font-bold">Sign</div>
            </div>

            <div class="stats-col">
                <div class="tax-box">
                    <div class="total-row">
                        <span>CGST</span>
                        <span>{{totals.cgst}}</span>
                    </div>
                    <div class="total-row">
                        <span>SGST</span>
                        <span>{{totals.sgst}}</span>
                    </div>
                    <div class="total-row border-t" style="margin-top: 20px; font-weight: bold;">
                        <span>Total GST</span>
                        <span>{{totals.taxAmount}}</span>
                    </div>
                </div>
                <div class="totals-box">
                    <div class="total-row">
                        <span>Total Item(s)</span>
                        <span>{{totalItems}}</span>
                    </div>
                    <div class="total-row">
                        <span>Total MRP</span>
                        <span>{{totals.totalMrp}}</span>
                    </div>
                    <div class="total-row">
                        <span>Round off.</span>
                        <span>{{totals.roundOff}}</span>
                    </div>

                    <div class="net-payable flex justify-between">
                        <span>Net Payable</span>
                        <span>Rs. {{totals.grandTotal}}</span>
                    </div>

                    <div class="saving-row">
                        Total Saving: <span style="font-weight: bold;">Rs. {{totals.totalSaving}}</span>
                    </div>
                    <div class="saving-row" style="margin-top:2px;">
                        Billed By: {{billedBy}}
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-bar">
            {{#if footerText}}
            <div style="text-align: center; font-size: 9px; color: #666; padding: 5px 0;">
                {{footerText}}
            </div>
            {{/if}}
        </div>
    </div>
</body>

</html>